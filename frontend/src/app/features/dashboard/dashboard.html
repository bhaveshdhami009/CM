<div class="dashboard-container fade-in">
  
  <!-- HEADER & FILTER -->
  <div class="dash-header">
    <div class="welcome">
      <h1>Dashboard</h1>
      <p>Overview for {{ authService.currentUser()?.full_name }}</p>
    </div>
    
    <div class="date-controls">
      <div class="presets">
        <!-- Added 'Day' option if needed, or keep Week/Month/Year -->
        <button [class.active]="dateRange==='week'" (click)="setRange('week')">7 Days</button>
        <button [class.active]="dateRange==='month'" (click)="setRange('month')">30 Days</button>
        <button [class.active]="dateRange==='year'" (click)="setRange('year')">Year</button>
      </div>
      <div class="custom-range">
        <input type="date" [(ngModel)]="customStart" (change)="onCustomDateChange()">
        <span>-</span>
        <input type="date" [(ngModel)]="customEnd" (change)="onCustomDateChange()">
      </div>
    </div>
  </div>

  <!-- STATS ROW (Links to Explorer with filters) -->
  <div class="stats-grid">
    <a routerLink="/explorer" [queryParams]="{ type: 'logs', status: 'completed' }" class="stat-card stat-card--blue">
      <div class="stat-card__icon"><i class="material-icons">assignment_turned_in</i></div>
      <div class="stat-card__info">
        <span class="value">{{ stats.tasksCompleted || 0 }}</span>
        <span class="label">Tasks Done</span>
      </div>
    </a>
    <a routerLink="/explorer" [queryParams]="{ type: 'hearings' }" class="stat-card stat-card--green">
      <div class="stat-card__icon"><i class="material-icons">gavel</i></div>
      <div class="stat-card__info">
        <span class="value">{{ stats.hearingsCount || 0 }}</span>
        <span class="label">Hearings</span>
      </div>
    </a>
    <a routerLink="/explorer" [queryParams]="{ type: 'cases' }" class="stat-card stat-card--purple">
      <div class="stat-card__icon"><i class="material-icons">folder_open</i></div>
      <div class="stat-card__info">
        <span class="value">{{ stats.casesFiled || 0 }}</span>
        <span class="label">New Cases</span>
      </div>
    </a>
    <a routerLink="/explorer" [queryParams]="{ type: 'logs', status: 'pending' }" class="stat-card stat-card--orange">
      <div class="stat-card__icon"><i class="material-icons">pending_actions</i></div>
      <div class="stat-card__info">
        <span class="value">{{ stats.totalPendingTasks || 0 }}</span>
        <span class="label">Pending Now</span>
      </div>
    </a>
  </div>

  <!-- ANNOUNCEMENTS -->
  <div class="announcements-area" *ngIf="widgets.announcements.length > 0">
    <div *ngFor="let ann of widgets.announcements" class="ann-banner" [class.ann-banner--global]="ann.scope === 'GLOBAL'">
       <i class="material-icons ann-banner__icon">campaign</i>
       <div class="ann-banner__text">
         <strong>{{ ann.title }}:</strong> {{ ann.message }}
       </div>
       <small class="ann-banner__date">{{ ann.created_at | date:'shortDate' }}</small>
    </div>
  </div>

  <!-- MAIN GRID -->
  <div class="content-grid">
    
    <!-- LEFT COLUMN -->
    <div>
      
      <!-- UPCOMING HEARINGS -->
      <div class="card widget-card">
        <div class="card__body">
          <div class="widget-header">
            <h3>Upcoming Hearings</h3>
            <a routerLink="/calendar" class="link">View Calendar</a>
          </div>
          <div class="list-view">
            <div *ngFor="let h of widgets.upcomingHearings" class="list-item">
               <div class="list-item__date-badge">
                 <span class="day">{{ h.hearing_date | date:'dd' }}</span>
                 <span class="month">{{ h.hearing_date | date:'MMM' }}</span>
               </div>
               <div class="list-item__content">
                 <!-- Safe Navigation (?) -->
                 <a *ngIf="h.case" [routerLink]="['/cases', h.case.id]" class="title">{{ getTitle(h.case) }}</a>
                 <div class="meta">{{ h.case.court?.name || 'Unknown Court' }} • {{ h.purpose }}</div>
               </div>
            </div>
            <div *ngIf="widgets.upcomingHearings.length === 0" class="empty-message">No upcoming hearings.</div>
          </div>
        </div>
      </div>

      <div class="card widget-card">
        <div class="card__body">
          <div class="widget-header">
            <h3>New Cases</h3>
            <a routerLink="/explorer" [queryParams]="{ type: 'cases'}" class="link">View All</a>
          </div>
          <div class="list-view">
            <div *ngFor="let c of widgets.recentCases" class="list-item">
               <div class="icon-circle bg-light-purple">
                 <i class="material-icons text-purple">folder</i>
               </div>
               <div class="list-item__content">
                 <a [routerLink]="['/cases', c.id]" class="title">{{ getTitle(c) }}</a>
                 <div class="meta">
                    {{ c.court?.name || 'Unknown Court' }} • {{ c.created_at | date:'mediumDate' }}
                 </div>
               </div>
            </div>
            <div *ngIf="widgets.recentCases.length === 0" class="empty-message">No cases found.</div>
          </div>
        </div>
      </div>
      
      <!-- RECENT ACTIVITY -->
      <div class="card widget-card">
        <div class="card__body">
          <div class="widget-header">
            <h3>Recent Activity</h3>
            <a routerLink="/explorer" [queryParams]="{ type: 'logs'}" class="link">View Logs</a>
          </div>
          <div class="list-view">
             <div *ngFor="let log of widgets.recentActivity" class="list-item">
               <i class="material-icons" style="color: var(--text-secondary); margin-top: 2px;">history</i>
               <div class="list-item__content">
                 <div class="text">
                   <strong>{{ log.creator?.full_name }}</strong> added "{{ log.purpose }}" 
                    <ng-container *ngIf="log.case">
                       for <a [routerLink]="['/cases', log.case.id]" class="case-link">
                          {{ getTitle(log.case) }}
                       </a>
                    </ng-container>
                 </div>
                 <div class="meta">{{ (log.updated_at || log.log_date) | date:'short' }}</div>
               </div>
             </div>
             <div *ngIf="widgets.recentActivity.length === 0" class="empty-message">
                No recent activity.
             </div>
          </div>
        </div>
      </div>
      
    </div>

    <!-- RIGHT COLUMN -->
    <div>
      
      <!-- PENDING TASKS -->
      <div class="card widget-card">
        
        <div class="card__body">
          <div class="widget-header">
            <h3>Pending Tasks</h3>
            <a routerLink="/explorer" [queryParams]="{ type: 'logs'}" class="link">View All</a>
          </div>
          <div class="task-list">
             <div *ngFor="let task of widgets.pendingTasks" class="task-card">
               <div class="task-card__header">
                 <span class="badge badge--warning">{{ task.purpose }}</span>
                 <span class="task-card__date">{{ task.log_date | date:'mediumDate' }}</span>
               </div>
               
               <a *ngIf="task.case" [routerLink]="['/cases', task.case.id]" class="task-card__title">
                 {{ getTitle(task.case) }}
               </a>
               
               <p class="task-card__desc" *ngIf="task.remarks">{{ task.remarks }}</p>
             </div>
             
             <div *ngIf="widgets.pendingTasks.length === 0" class="empty-message">
               All caught up! No pending tasks.
             </div>
          </div>
        </div>
      </div>

      <!-- QUICK ACTIONS -->
      <div class="quick-actions">
         <a routerLink="/cases/create" class="action-btn">
           <i class="material-icons">add_circle</i>
           <span>New Case</span>
         </a>
         <a routerLink="/calendar" class="action-btn">
           <i class="material-icons">calendar_month</i>
           <span>Schedule</span>
         </a>
         <a routerLink="/explorer" class="action-btn">
           <i class="material-icons">search</i>
           <span>Search</span>
         </a>
      </div>

    </div>
  </div>
</div>